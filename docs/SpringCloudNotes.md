# 一、SpringCloud Alibaba ：Nacos、Dubbo、Sentinel

## 1.1 Nacos

Nacos是一个服务注册中心，主要是允许**服务的动态注册和发现**，配置，健康管理，路由等。

**心跳机制：**一个服务启动后，会向Nacos的注册中心发送一个注册请求，包括IP、端口号、服务名，Nacos接收成功后会保存到注册表，之后，服务实例会定期向Nacos发送心跳请求，以保证自己的健康状态，心跳请求包括内存使用情况，CPU负载等，Nacos收到心跳请求之后，会去检测这个请求，确认服务实例的状态是否健康，健康则可用，不健康或者一定时间内没收到心跳请求则认为该实例不可用，并将其从注册表中移除，而当一个服务消费者需要调用某个服务时，会向Nacos发送服务发现请求，指定要查找的服务名，Nacos会返回所有可用的服务实例给消费者，包括网址和健康状态。

​				

## 1.2 Dubbo

Dubbo是一个服务与服务之间通过**RPC**调用的框架，有两个重要角色,

**提供者:**  指具体服务提供方，提供者需要实现服务的接口，并将实现类注册到Dubbo中，配置对应的服务注册中心，将自身提供的服务注册到注册中心，以供消费者发现和使用，提供者还需要配置对应的协议和端口，来接收消费者的**RPC**请求。

**消费者：**指具体服务消费方，在Dubbo中，需要引入提供者的接口的依赖，并通过Dubbo的API进行服务的引用，消费者需要配置对应的注册中心，用于发现并获取提供者的地址信息，可通过**RPC**请求调用提供者的方法来访问和使用服务。

**Dubbo：**Dubbo是一个提供者和消费者之间的**中间件**，负责服务的注册和发现，负载均衡，远程调用，容错处理等。Dubbo注册的信息会有自己的标签（producer&consumer），内部使用。



## 1.3 Sentinel

Sentinel可以在分布式系统中实现流量控制，熔断降级，系统负载保护，实时监控的功能。

**流量控制：**Sentinel 使用令牌桶算法对请求进行限流控制，根据应用的负载情况设置最大并发数，QPS等限制参数，并对请求进行计数和比较，从而控制允许通过的请求数量。（理解为限制嘴巴的大小）

**熔断降级：**Sentinel通过定义规则监控服务的调用情况，当出现异常请求数量到达阀值，会触发熔断器，避免故障的进一步扩散，在熔断状态下，可根据配置的策略返回预设的响应，（自己写的降级数据或异常信息）。

**系统负载保护：**Sentinel 监控系统的负载情况，通过定义规则来触发相应的保护措施，如拒绝请求或减少并发数。可以根据系统的负载情况，设置合适的阈值和策略，在保护系统稳定性的前提下，提高系统的处理能力。（理解为监控一个人的身体状态）

**实时监控：**Sentinel 提供了一个监控中心，用户可以通过 Sentinel Dashboard 进行实时监控和统计。监控中心收集并展示流量控制、熔断降级、系统负载等相关数据，并以可视化的方式展示给用户。用户可以通过监控中心及时发现问题、查看监控指标，从而进行系统优化和故障处理。

# 二、SpringCloud Gateway

SpringCloud Gateway是一个非阻塞式的API网关，主要特性：

**路由转发：**根据请求的URl及其他条件如路径、主机和请求头之类，将请求转发到不同的目标服务。

**过滤器：**过滤器可以放在请求转发到目标Service前或者后使用，可实现权限控制，请求日志记录等。

**负载均衡：**Spring Cloud Gateway集成了Spring Cloud的负载均衡器，可以实现请求的负载均衡，将请求转发到多个目标服务实例中。



# 三、Nginx

可看作一个网关，主要作用是抵御第一波用户流量，为后面的API Gateway网关做负载均衡，还具有反向代理的作用，可以用作反向代理服务器，接收客户端的请求，并将请求转发到后端的应用服务器。通过负载均衡算法，Nginx可以将请求均匀地分发给多个应用服务器，提高系统的吞吐量和稳定性。

# 四、Rocketmq

Rocketmq本质是一个消息中间件，用来传递大量的异步消息，优势：**高吞吐量、低延迟和高可靠性**，结构由生产者、消费者、NameServer和Broker组成。

**生产者：**生产者负责发消息给RocketMQ，将消息发送到指定的Topic，可选同步或异步的方式发送消息，并可以指定消息的优先级。

**消费者：**消费者从RocketMQ订阅指定的Topic，并消费对应的消息。

**NameServer：**这是一个命名服务组件，负责记录和管理Broker的地址信息，从而可以找到可用的Broker来进行消息的发送和消费。

**Broker：**Broker是消息中转和存储的核心组件，每个Broker负责存储和管理一部分Topic的消息，并提供消息的路由消息，生产者发送消息时通过Broker来存储，然后依靠Broker的同步复制机制达到高可靠性，消费者从Broker中再拉取消息进行消费。

#### 	完整流程：生产者与Nameserver通信，找到可用的Broker地址信息，根据指定的Topic选择一个Broker，选择同步或异步的方式发送消息给这个Broker储存，这个Broker收到消息后，先储存消息到本地磁盘上，然后依靠同步复制机制复制消息到其他的Broker上，消费者与Nameserver通信，然后获得可用的Broker地址信息，订阅指定的Topic，从指定的Broker中拉取消息进行消费，消费完之后向Broker发送消息确认，告诉Broker已经消费完毕，Broker收到确认消息后，将消息标记为已消费。

# 五、Redis

Redis是一个高性能的键值存储的非关系型内存数据库，**主要作用：**缓存，数据储存，分布式锁。

**项目中的使用：**

1. 缓存：Redis的高性能和灵活的数据结构使其成为一个很好的缓存解决方案。可以将热点数据存储在Redis中，提高读取性能，减轻数据库的负载压力。
2. 分布式锁：Redis提供了原子性操作和分布式锁的支持，可以保证多个线程或多个服务之间的操作是互斥的，避免并发冲突。
3. 消息队列：Redis的发布-订阅模式（Pub/Sub）和列表（List）数据结构可以用于构建简单的消息队列系统，用于实现异步消息处理、任务调度等功能。
4. 会话存储：可以使用Redis来存储用户的会话信息，例如登录状态、用户权限等，以减轻后端服务器的负载压力，并使得多个后端服务器之间可以共享会话数据。
5. 计数器和排行榜：Redis的原子性操作和有序集合数据结构可以用于实现计数器和排行榜等功能，例如统计文章的点击量、用户的积分排名等。
6. 地理位置定位：Redis提供了地理位置定位的功能，可以存储和查询地理位置信息，例如搜索附近的商家、计算两个坐标之间的距离等。

**Redis的几种模式：**

1. **主从复制：**通过配置Redis的主从复制模式，可将数据从一个Redis主节点同步到多个从节点，实现数据的备份和故障恢复，可用从节点来进行读操作，提高系统的读性能和可用性。
2. **哨兵模式：**Redis哨兵模式可以监控主节点的状态，当主节点故障时，自动选举其中一个从节点作为新的主节点，实现主节点的故障转移。通过配置多个哨兵节点，可以提高系统的可用性。
3. **集群模式：**Redis集群模式可以将数据分布在多个节点上，实现数据的水平拆分和负载均衡。集群模式中的每个节点都是独立运行的，可以并行处理请求，提高系统的性能和扩展性。
4. **分片模式：**Redis分片模式将数据分散存储在多个节点上，不同的数据可以放在不同的节点上进行操作，实现数据的垂直切分。可以通过一致性哈希算法或自定义分片策略来确定数据应该存储在哪个节点上。
5. **缓存穿透和雪崩的解决方案：**在分布式系统中，由于缓存的命中率不高或者大量的请求同时过来，可能会导致缓存穿透或者缓存雪崩问题。可以通过设置合理的过期时间、使用互斥锁、引入热点数据预加载等措施来解决这些问题。
6. **分布式锁：**在分布式系统中，为了保证多个线程或多个服务之间的操作是互斥的，可以使用Redis的分布式锁机制，例如基于SETNX命令实现的简单锁、基于RedLock算法实现的分布式锁等。



